{
  "prdFilename": "product-id-extractor-package",
  "tasks": [
    {
      "id": "1",
      "title": "Core extraction function implementation",
      "description": "Implement extractIdsFromUrlComponents() with typed input/output, Zod validation in dev mode, and frozen output arrays",
      "status": "done",
      "priority": "high",
      "dependencies": [],
      "details": "Create the main extraction function that accepts urlComponents from @rr/url-parser and optional storeId. Returns { productIds: readonly string[], storeId?: string } with frozen, sorted, deduplicated arrays (max 12 items). Export TypeScript types and Zod schemas.",
      "testStrategy": "Unit tests with various URL structures, type checking, and output immutability validation",
      "subtasks": [],
      "userStoryId": "US001",
      "createdAt": "2025-12-08T21:15:30.908Z",
      "updatedAt": "2025-12-08T21:19:30.793Z",
      "complexity": 4,
      "recommendedSubtasks": 3,
      "completedAt": "2025-12-08T21:19:30.793Z"
    },
    {
      "id": "2",
      "title": "Pathname pattern extractor",
      "description": "Implement patternExtractor() function to apply regex patterns to URL pathnames with capture group extraction",
      "status": "done",
      "priority": "high",
      "dependencies": ["1"],
      "details": "Create patternExtractor() that applies regex patterns to pathname, extracts IDs from capture groups 1 and 2, tries patterns in priority order, deduplicates via Set, and returns frozen sorted array.",
      "testStrategy": "Test with store-specific patterns, multiple pattern matching, capture group extraction",
      "subtasks": [],
      "userStoryId": "US002",
      "createdAt": "2025-12-08T21:15:30.957Z",
      "updatedAt": "2025-12-08T21:19:30.834Z",
      "complexity": 4,
      "recommendedSubtasks": 3,
      "completedAt": "2025-12-08T21:19:30.834Z"
    },
    {
      "id": "3",
      "title": "Query parameter extraction",
      "description": "Implement generic search pattern for extracting IDs from common query parameters (sku, pid, productId, etc.)",
      "status": "done",
      "priority": "high",
      "dependencies": ["1"],
      "details": "Create SEARCH_PATTERN regex to extract from: sku, pid, id, productid, skuid, athcpid, upc_id, variant, prdtno. IDs must be 4-24 chars alphanumeric with dashes. Merge with pathname results.",
      "testStrategy": "Test various query param formats, edge cases, deduplication with pathname results",
      "subtasks": [],
      "userStoryId": "US003",
      "createdAt": "2025-12-08T21:15:31.007Z",
      "updatedAt": "2025-12-08T21:19:30.872Z",
      "complexity": 4,
      "recommendedSubtasks": 3,
      "completedAt": "2025-12-08T21:19:30.872Z"
    },
    {
      "id": "4",
      "title": "Generic fallback patterns",
      "description": "Implement generic pathname patterns for /prod/, /prd/, /p/ prefixed IDs when no store-specific config exists",
      "status": "done",
      "priority": "medium",
      "dependencies": ["2"],
      "details": "Add PATTERNS.pathnamePatterns for /prod/, /prd/, /p/ prefixes requiring 6+ digit IDs. Also match numeric IDs at end of URL paths. Only run when store-specific extraction yields no results.",
      "testStrategy": "Test fallback scenarios, minimum digit requirements, path-end numeric extraction",
      "subtasks": [],
      "userStoryId": "US004",
      "createdAt": "2025-12-08T21:15:31.060Z",
      "updatedAt": "2025-12-08T21:19:30.909Z",
      "complexity": 3,
      "recommendedSubtasks": 2,
      "completedAt": "2025-12-08T21:19:30.909Z"
    },
    {
      "id": "5",
      "title": "Timeout and ReDoS protection",
      "description": "Implement timeout protection (100ms) with iteration checking and safe-regex validation",
      "status": "done",
      "priority": "high",
      "dependencies": ["2"],
      "details": "Add PATTERN_EXTRACTOR_TIMEOUT_MS=100ms, check every 5 iterations (CHECK_INTERVAL), limit to 12 results. Log warning on timeout. Reset regex lastIndex in finally block. Use safe-regex to validate patterns.",
      "testStrategy": "Test timeout scenarios, iteration limits, regex state cleanup, safe-regex validation",
      "subtasks": [],
      "userStoryId": "US005",
      "createdAt": "2025-12-08T21:15:31.122Z",
      "updatedAt": "2025-12-08T21:19:30.945Z",
      "complexity": 4,
      "recommendedSubtasks": 3,
      "completedAt": "2025-12-08T21:19:30.945Z"
    },
    {
      "id": "6",
      "title": "HTTP API endpoint",
      "description": "Implement POST /product-identifiers/urls endpoint with batch support (1-100 URLs)",
      "status": "done",
      "priority": "medium",
      "dependencies": ["1", "3"],
      "details": "Create Lambda handler with Middy middleware. Accept { urls: [{ url, storeId? }] }, return results with productIds, storeId, count, success per URL plus summary. Validate URLs block localhost/private IPs.",
      "testStrategy": "Test batch processing, URL validation, error responses, summary calculations",
      "subtasks": [],
      "userStoryId": "US006",
      "createdAt": "2025-12-08T21:15:31.176Z",
      "updatedAt": "2025-12-08T21:19:30.981Z",
      "complexity": 3,
      "recommendedSubtasks": 2,
      "completedAt": "2025-12-08T21:19:30.981Z"
    },
    {
      "id": "7",
      "title": "Comprehensive test suite",
      "description": "Create 40+ JSON fixtures and 8 test files covering extraction, error handling, regex security",
      "status": "done",
      "priority": "high",
      "dependencies": ["1", "2", "3", "5"],
      "details": "Create __fixtures__/ with real merchant URLs. Write tests for extractor, paths, query params, regex security. Use describe.concurrent and test.concurrent.each. Validate global flag, lowercase patterns, safe-regex. Target 97%+ coverage.",
      "testStrategy": "Comprehensive coverage validation, concurrent execution, benchmark performance tests",
      "subtasks": [
        {
          "id": "7.1",
          "title": "Create JSON fixture files for store URLs",
          "description": "Create 40+ JSON fixture files in __fixtures__/ with real merchant URLs and expected product IDs",
          "status": "done",
          "priority": "high",
          "dependencies": [],
          "subtasks": [],
          "userStoryId": "US007",
          "createdAt": "2025-12-08T21:16:10.883Z",
          "updatedAt": "2025-12-08T21:19:31.015Z",
          "completedAt": "2025-12-08T21:19:31.015Z"
        },
        {
          "id": "7.2",
          "title": "Write extractor and pattern test files",
          "description": "Create test files for extractor, pathname patterns, query params with concurrent test execution",
          "status": "done",
          "priority": "high",
          "dependencies": ["7.1"],
          "subtasks": [],
          "userStoryId": "US007",
          "createdAt": "2025-12-08T21:16:10.883Z",
          "updatedAt": "2025-12-08T21:19:31.015Z",
          "completedAt": "2025-12-08T21:19:31.015Z"
        },
        {
          "id": "7.3",
          "title": "Add regex security and benchmark tests",
          "description": "Validate global flag, lowercase patterns, safe-regex checks, and performance benchmarks",
          "status": "done",
          "priority": "high",
          "dependencies": ["7.2"],
          "subtasks": [],
          "userStoryId": "US007",
          "createdAt": "2025-12-08T21:16:10.883Z",
          "updatedAt": "2025-12-08T21:19:31.015Z",
          "completedAt": "2025-12-08T21:19:31.015Z"
        }
      ],
      "userStoryId": "US007",
      "createdAt": "2025-12-08T21:15:31.232Z",
      "updatedAt": "2025-12-08T21:19:31.015Z",
      "complexity": 5,
      "recommendedSubtasks": 3,
      "completedAt": "2025-12-08T21:19:31.015Z"
    }
  ],
  "metadata": {
    "version": "1.0",
    "created": "2025-12-08T21:15:30.908Z",
    "lastUpdated": "2025-12-08T21:19:31.015Z",
    "totalTasks": 10,
    "completedTasks": 10,
    "blockedTasks": 0
  }
}
