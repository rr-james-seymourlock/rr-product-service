{
  "openapi": "3.1.0",
  "info": {
    "title": "RR Product Service API",
    "version": "1.0.0",
    "description": "Product service API for extracting product identifiers from e-commerce URLs. Supports URL parsing, normalization, and pattern-based ID extraction for Rakuten merchant stores.",
    "contact": {
      "name": "RR Product Service Team"
    }
  },
  "servers": [
    {
      "url": "https://api.example.com/prod",
      "description": "Production"
    },
    {
      "url": "https://api.example.com/dev",
      "description": "Development"
    },
    {
      "url": "http://localhost:3000",
      "description": "Local"
    }
  ],
  "tags": [
    {
      "name": "Monitoring",
      "description": "Service health and monitoring endpoints"
    },
    {
      "name": "Product Identifier Extraction",
      "description": "Extract product identifiers from URLs and ASINs"
    }
  ],
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "healthy",
              "unhealthy"
            ],
            "description": "Current health status of the service",
            "example": "healthy"
          },
          "service": {
            "type": "string",
            "minLength": 1,
            "description": "Service name identifier",
            "example": "rr-product-service"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of the health check",
            "example": "2025-11-25T20:00:00.000Z"
          },
          "version": {
            "type": "string",
            "minLength": 1,
            "description": "Service version",
            "example": "1.0.0"
          },
          "environment": {
            "type": "string",
            "minLength": 1,
            "description": "Deployment environment",
            "example": "production"
          }
        },
        "required": [
          "status",
          "service",
          "timestamp",
          "version",
          "environment"
        ]
      },
      "SuccessResult": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that was analyzed",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "storeId": {
            "type": "string",
            "minLength": 1,
            "description": "Store ID determined from URL domain or provided in request. Used for pattern matching.",
            "example": "9528"
          },
          "productIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1,
              "maxLength": 24,
              "pattern": "^[\\w-]+$"
            },
            "maxItems": 12,
            "description": "Array of extracted product IDs (max 12)",
            "example": [
              "cn8490-100",
              "6n8tkb"
            ]
          },
          "count": {
            "type": "integer",
            "minimum": 0,
            "maximum": 12,
            "description": "Number of product IDs extracted",
            "example": 2
          },
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "description": "Indicates successful processing",
            "example": true
          }
        },
        "required": [
          "url",
          "productIds",
          "count",
          "success"
        ]
      },
      "FailureResult": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that failed",
            "example": "https://invalid-url"
          },
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "url: Invalid URL format"
          },
          "success": {
            "type": "boolean",
            "enum": [
              false
            ],
            "description": "Indicates failed processing",
            "example": false
          }
        },
        "required": [
          "url",
          "error",
          "message",
          "success"
        ]
      },
      "AnalysisResult": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/SuccessResult"
          },
          {
            "$ref": "#/components/schemas/FailureResult"
          }
        ]
      },
      "CreateUrlAnalysisResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AnalysisResult"
            },
            "description": "Array of analysis results, one per input URL",
            "example": [
              {
                "url": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100",
                "productIds": [
                  "cn8490-100",
                  "6n8tkb"
                ],
                "count": 2,
                "success": true
              },
              {
                "url": "https://invalid-url",
                "error": "ValidationError",
                "message": "url: Invalid URL format",
                "success": false
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of URLs processed",
            "example": 2
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully processed URLs",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed URLs",
            "example": 1
          }
        },
        "required": [
          "results",
          "total",
          "successful",
          "failed"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "url: Invalid URL format"
          },
          "statusCode": {
            "type": "integer",
            "minimum": 400,
            "maximum": 599,
            "description": "HTTP status code",
            "example": 400
          }
        },
        "required": [
          "error",
          "message",
          "statusCode"
        ]
      },
      "UrlItem": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "format": "uri",
            "description": "Public HTTP(S) URL to extract product IDs from",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "storeId": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Optional store identifier for specific extraction patterns. If not provided, domain is extracted from URL automatically. Recommended: Pass internal Rakuten store ID (e.g., \"9528\") for best performance. Also accepts domain format (e.g., \"nike.com\")",
            "example": "9528"
          }
        },
        "required": [
          "url"
        ]
      },
      "CreateUrlAnalysisRequest": {
        "type": "object",
        "properties": {
          "urls": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UrlItem"
            },
            "minItems": 1,
            "maxItems": 100,
            "description": "Array of URLs to analyze (1-100 per request)",
            "example": [
              {
                "url": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100",
                "storeId": "9528"
              },
              {
                "url": "https://www.target.com/p/example-product/-/A-12345678"
              }
            ]
          }
        },
        "required": [
          "urls"
        ]
      },
      "AsinSuccessResult": {
        "type": "object",
        "properties": {
          "asin": {
            "type": "string",
            "minLength": 10,
            "maxLength": 10,
            "description": "The ASIN that was converted",
            "example": "B08N5WRWNW"
          },
          "identifiers": {
            "type": "object",
            "properties": {
              "upc": {
                "type": "string",
                "description": "Universal Product Code",
                "example": "012345678905"
              },
              "sku": {
                "type": "string",
                "description": "Stock Keeping Unit",
                "example": "SKU-123"
              },
              "mpn": {
                "type": "string",
                "description": "Manufacturer Part Number",
                "example": "MPN-456"
              }
            },
            "description": "Structured product identifiers (UPC, SKU, MPN)",
            "example": {
              "upc": "012345678905",
              "sku": "SKU-123",
              "mpn": "MPN-456"
            }
          },
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "description": "Indicates successful conversion",
            "example": true
          }
        },
        "required": [
          "asin",
          "identifiers",
          "success"
        ]
      },
      "AsinFailureResult": {
        "type": "object",
        "properties": {
          "asin": {
            "type": "string",
            "minLength": 10,
            "maxLength": 10,
            "description": "The ASIN that failed conversion",
            "example": "B0EXAMPLE"
          },
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ProductNotFoundError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "Product not found for ASIN: B0EXAMPLE"
          },
          "success": {
            "type": "boolean",
            "enum": [
              false
            ],
            "description": "Indicates failed conversion",
            "example": false
          }
        },
        "required": [
          "asin",
          "error",
          "message",
          "success"
        ]
      },
      "AsinConversionResult": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/AsinSuccessResult"
          },
          {
            "$ref": "#/components/schemas/AsinFailureResult"
          }
        ]
      },
      "ConvertAsinResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AsinConversionResult"
            },
            "description": "Array of conversion results, one per input ASIN",
            "example": [
              {
                "asin": "B08N5WRWNW",
                "identifiers": {
                  "upc": "012345678905",
                  "sku": "SKU-123",
                  "mpn": "MPN-456"
                },
                "success": true
              },
              {
                "asin": "B0EXAMPLE",
                "error": "ProductNotFoundError",
                "message": "Product not found for ASIN: B0EXAMPLE",
                "success": false
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of ASINs processed",
            "example": 2
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully converted ASINs",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed conversions",
            "example": 1
          }
        },
        "required": [
          "results",
          "total",
          "successful",
          "failed"
        ]
      },
      "ConvertAsinRequest": {
        "type": "object",
        "properties": {
          "asins": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 10,
              "maxLength": 10,
              "pattern": "^[A-Z0-9]{10}$",
              "description": "Amazon Standard Identification Number (10 alphanumeric characters)",
              "example": "B08N5WRWNW"
            },
            "minItems": 1,
            "maxItems": 10,
            "description": "Array of Amazon ASINs to convert to product identifiers (UPC, SKU, MPN)",
            "example": [
              "B08N5WRWNW",
              "B07ZPKN6YR"
            ]
          }
        },
        "required": [
          "asins"
        ]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Health check endpoint for monitoring and load balancer probes",
        "tags": [
          "Monitoring"
        ],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/product-identifiers/urls": {
      "post": {
        "summary": "Extract Product Identifiers from URLs",
        "description": "Extracts product identifiers from one or more product URLs using pattern-based rule sets. Accepts 1-100 URLs per request. Handles partial failures gracefully - each URL is processed independently and results include success/failure status. Returns summary statistics along with individual results. Supports URLs from various e-commerce stores.",
        "tags": [
          "Product Identifier Extraction"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUrlAnalysisRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully extracted product IDs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateUrlAnalysisResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ValidationError",
                  "message": "urls: At least one URL is required",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "InternalServerError",
                  "message": "An unexpected error occurred",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    },
    "/product-identifiers/asins": {
      "post": {
        "summary": "Convert ASINs to Product Identifiers",
        "description": "Converts Amazon Standard Identification Numbers (ASINs) to product identifiers including GTINs (UPC/EAN), MPN, and SKU. Uses the Synccentric product database API. Accepts 1-10 ASINs per request and returns all available product identifiers. Handles partial failures gracefully - each ASIN is processed independently and results include success/failure status.",
        "tags": [
          "Product Identifier Extraction"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConvertAsinRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully converted ASINs to product identifiers",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConvertAsinResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ValidationError",
                  "message": "asins: Array must contain at least 1 element(s)",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error or API error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ApiRequestError",
                  "message": "Synccentric API request failed: 500 Internal Server Error",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}