{
  "openapi": "3.1.0",
  "info": {
    "title": "RR Product Service API",
    "version": "1.0.0",
    "description": "Product service API for extracting product identifiers from e-commerce URLs. Supports URL parsing, normalization, and pattern-based ID extraction for Rakuten merchant stores.",
    "contact": {
      "name": "RR Product Service Team"
    }
  },
  "servers": [
    {
      "url": "https://api.example.com/prod",
      "description": "Production"
    },
    {
      "url": "https://api.example.com/dev",
      "description": "Development"
    },
    {
      "url": "http://localhost:3000",
      "description": "Local"
    }
  ],
  "tags": [
    {
      "name": "Monitoring",
      "description": "Service health and monitoring endpoints"
    },
    {
      "name": "Product Extraction",
      "description": "Product identifier extraction endpoints"
    }
  ],
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "healthy",
              "unhealthy"
            ],
            "description": "Current health status of the service",
            "example": "healthy"
          },
          "service": {
            "type": "string",
            "minLength": 1,
            "description": "Service name identifier",
            "example": "rr-product-service"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of the health check",
            "example": "2025-11-25T20:00:00.000Z"
          },
          "version": {
            "type": "string",
            "minLength": 1,
            "description": "Service version",
            "example": "1.0.0"
          },
          "environment": {
            "type": "string",
            "minLength": 1,
            "description": "Deployment environment",
            "example": "production"
          }
        },
        "required": [
          "status",
          "service",
          "timestamp",
          "version",
          "environment"
        ]
      },
      "CreateUrlAnalysisResponse": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that was analyzed",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "productIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1,
              "maxLength": 24,
              "pattern": "^[\\w-]+$"
            },
            "maxItems": 12,
            "description": "Array of extracted product IDs (max 12)",
            "example": [
              "cn8490-100",
              "6n8tkb"
            ]
          },
          "count": {
            "type": "integer",
            "minimum": 0,
            "maximum": 12,
            "description": "Number of product IDs extracted",
            "example": 2
          }
        },
        "required": [
          "url",
          "productIds",
          "count"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "url: Invalid URL format"
          },
          "statusCode": {
            "type": "integer",
            "minimum": 400,
            "maximum": 599,
            "description": "HTTP status code",
            "example": 400
          }
        },
        "required": [
          "error",
          "message",
          "statusCode"
        ]
      },
      "CreateUrlAnalysisRequest": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "format": "uri",
            "description": "Public HTTP(S) URL to extract product IDs from",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "storeId": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Optional store ID to use specific extraction patterns",
            "example": "12345"
          }
        },
        "required": [
          "url"
        ]
      },
      "SuccessResult": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that was analyzed",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "productIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1,
              "maxLength": 24,
              "pattern": "^[\\w-]+$"
            },
            "maxItems": 12,
            "description": "Array of extracted product IDs (max 12)",
            "example": [
              "cn8490-100",
              "6n8tkb"
            ]
          },
          "count": {
            "type": "integer",
            "minimum": 0,
            "maximum": 12,
            "description": "Number of product IDs extracted",
            "example": 2
          },
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "description": "Indicates successful processing",
            "example": true
          }
        },
        "required": [
          "url",
          "productIds",
          "count",
          "success"
        ]
      },
      "FailureResult": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that failed",
            "example": "https://invalid-url"
          },
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "url: Invalid URL format"
          },
          "success": {
            "type": "boolean",
            "enum": [
              false
            ],
            "description": "Indicates failed processing",
            "example": false
          }
        },
        "required": [
          "url",
          "error",
          "message",
          "success"
        ]
      },
      "BatchResult": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/SuccessResult"
          },
          {
            "$ref": "#/components/schemas/FailureResult"
          }
        ]
      },
      "CreateBatchUrlAnalysisResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BatchResult"
            },
            "description": "Array of analysis results, one per input URL",
            "example": [
              {
                "url": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100",
                "productIds": [
                  "cn8490-100",
                  "6n8tkb"
                ],
                "count": 2,
                "success": true
              },
              {
                "url": "https://invalid-url",
                "error": "ValidationError",
                "message": "url: Invalid URL format",
                "success": false
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of URLs processed",
            "example": 2
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully processed URLs",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed URLs",
            "example": 1
          }
        },
        "required": [
          "results",
          "total",
          "successful",
          "failed"
        ]
      },
      "UrlItem": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "format": "uri",
            "description": "Public HTTP(S) URL to extract product IDs from",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "storeId": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Optional store ID to use specific extraction patterns",
            "example": "12345"
          }
        },
        "required": [
          "url"
        ]
      },
      "CreateBatchUrlAnalysisRequest": {
        "type": "object",
        "properties": {
          "urls": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UrlItem"
            },
            "minItems": 1,
            "maxItems": 100,
            "description": "Array of URLs to analyze (max 100 per request)",
            "example": [
              {
                "url": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100",
                "storeId": "12345"
              },
              {
                "url": "https://www.target.com/p/example-product/-/A-12345678"
              }
            ]
          }
        },
        "required": [
          "urls"
        ]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Health check endpoint for monitoring and load balancer probes",
        "tags": [
          "Monitoring"
        ],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/url-analysis": {
      "post": {
        "summary": "Analyze URL",
        "description": "Analyzes a product URL and extracts product identifiers. Supports URLs from various e-commerce stores. Returns extracted product identifiers found in the URL path, query parameters, or fragments.",
        "tags": [
          "Product Extraction"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUrlAnalysisRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully extracted product IDs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateUrlAnalysisResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ValidationError",
                  "message": "url: Invalid URL format",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "InternalServerError",
                  "message": "An unexpected error occurred",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    },
    "/url-analysis/batch": {
      "post": {
        "summary": "Analyze URLs in Batch",
        "description": "Analyzes multiple product URLs in parallel and extracts product identifiers. Accepts 1-100 URLs per request. Handles partial failures gracefully - each URL is processed independently and results include success/failure status. Returns summary statistics along with individual results.",
        "tags": [
          "Product Extraction"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBatchUrlAnalysisRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Batch processing completed (may include partial failures)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateBatchUrlAnalysisResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "properties": {
                        "error": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Error type/code",
                          "example": "ValidationError"
                        },
                        "message": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Human-readable error message",
                          "example": "urls: At least one URL is required"
                        },
                        "statusCode": {
                          "type": "integer",
                          "minimum": 400,
                          "maximum": 599,
                          "description": "HTTP status code",
                          "example": 400
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "error": "ValidationError",
                  "message": "urls: At least one URL is required",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "properties": {
                        "error": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Error type/code",
                          "example": "ValidationError"
                        },
                        "message": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Human-readable error message",
                          "example": "urls: At least one URL is required"
                        },
                        "statusCode": {
                          "type": "integer",
                          "minimum": 400,
                          "maximum": 599,
                          "description": "HTTP status code",
                          "example": 400
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "error": "InternalServerError",
                  "message": "An unexpected error occurred",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}