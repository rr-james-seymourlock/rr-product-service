{
  "openapi": "3.1.0",
  "info": {
    "title": "RR Product Service API",
    "version": "1.0.0",
    "description": "Product service API for extracting product identifiers from e-commerce URLs. Supports URL parsing, normalization, and pattern-based ID extraction for Rakuten merchant stores.",
    "contact": {
      "name": "RR Product Service Team"
    }
  },
  "servers": [
    {
      "url": "https://api.example.com/prod",
      "description": "Production"
    },
    {
      "url": "https://api.example.com/dev",
      "description": "Development"
    },
    {
      "url": "http://localhost:3000",
      "description": "Local"
    }
  ],
  "tags": [
    {
      "name": "Monitoring",
      "description": "Service health and monitoring endpoints"
    },
    {
      "name": "Product Identifier Extraction",
      "description": "Extract product identifiers from URLs and ASINs"
    },
    {
      "name": "Event Normalization",
      "description": "Normalize cart and product view events from apps and extensions using @rr/cart-event-normalizer and @rr/product-event-normalizer packages"
    }
  ],
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["healthy", "unhealthy"],
            "description": "Current health status of the service",
            "example": "healthy"
          },
          "service": {
            "type": "string",
            "minLength": 1,
            "description": "Service name identifier",
            "example": "rr-product-service"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of the health check",
            "example": "2025-11-25T20:00:00.000Z"
          },
          "version": {
            "type": "string",
            "minLength": 1,
            "description": "Service version",
            "example": "1.0.0"
          },
          "environment": {
            "type": "string",
            "minLength": 1,
            "description": "Deployment environment",
            "example": "production"
          }
        },
        "required": ["status", "service", "timestamp", "version", "environment"]
      },
      "SuccessResult": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that was analyzed",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "storeId": {
            "type": "string",
            "minLength": 1,
            "description": "Store ID determined from URL domain or provided in request. Used for pattern matching.",
            "example": "9528"
          },
          "productIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1,
              "maxLength": 24,
              "pattern": "^[\\w-]+$"
            },
            "maxItems": 12,
            "description": "Array of extracted product IDs (max 12)",
            "example": ["cn8490-100", "6n8tkb"]
          },
          "count": {
            "type": "integer",
            "minimum": 0,
            "maximum": 12,
            "description": "Number of product IDs extracted",
            "example": 2
          },
          "success": {
            "type": "boolean",
            "enum": [true],
            "description": "Indicates successful processing",
            "example": true
          }
        },
        "required": ["url", "productIds", "count", "success"]
      },
      "FailureResult": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "description": "The original URL that failed",
            "example": "https://invalid-url"
          },
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "url: Invalid URL format"
          },
          "success": {
            "type": "boolean",
            "enum": [false],
            "description": "Indicates failed processing",
            "example": false
          }
        },
        "required": ["url", "error", "message", "success"]
      },
      "AnalysisResult": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/SuccessResult"
          },
          {
            "$ref": "#/components/schemas/FailureResult"
          }
        ]
      },
      "CreateUrlAnalysisResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AnalysisResult"
            },
            "description": "Array of analysis results, one per input URL",
            "example": [
              {
                "url": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100",
                "storeId": "9528",
                "productIds": ["cn8490-100", "6n8tkb"],
                "count": 2,
                "success": true
              },
              {
                "url": "https://invalid-url",
                "error": "ValidationError",
                "message": "url: Invalid URL format",
                "success": false
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of URLs processed",
            "example": 2
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully processed URLs",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed URLs",
            "example": 1
          }
        },
        "required": ["results", "total", "successful", "failed"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "url: Invalid URL format"
          },
          "statusCode": {
            "type": "integer",
            "minimum": 400,
            "maximum": 599,
            "description": "HTTP status code",
            "example": 400
          }
        },
        "required": ["error", "message", "statusCode"]
      },
      "UrlItem": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "format": "uri",
            "description": "Public HTTP(S) URL to extract product IDs from",
            "example": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100"
          },
          "storeId": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Optional store identifier for specific extraction patterns. If not provided, domain is extracted from URL automatically. Recommended: Pass internal Rakuten store ID (e.g., \"9528\") for best performance. Also accepts domain format (e.g., \"nike.com\")",
            "example": "9528"
          }
        },
        "required": ["url"]
      },
      "CreateUrlAnalysisRequest": {
        "type": "object",
        "properties": {
          "urls": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UrlItem"
            },
            "minItems": 1,
            "maxItems": 100,
            "description": "Array of URLs to analyze (1-100 per request)",
            "example": [
              {
                "url": "https://www.nike.com/t/air-max-90-mens-shoes-6n8tKB/CN8490-100",
                "storeId": "9528"
              },
              {
                "url": "https://www.target.com/p/example-product/-/A-12345678"
              }
            ]
          }
        },
        "required": ["urls"]
      },
      "AsinSuccessResult": {
        "type": "object",
        "properties": {
          "asin": {
            "type": "string",
            "minLength": 10,
            "maxLength": 10,
            "description": "The ASIN that was converted",
            "example": "B08N5WRWNW"
          },
          "identifiers": {
            "type": "object",
            "properties": {
              "upc": {
                "type": "string",
                "description": "Universal Product Code",
                "example": "012345678905"
              },
              "sku": {
                "type": "string",
                "description": "Stock Keeping Unit",
                "example": "SKU-123"
              },
              "mpn": {
                "type": "string",
                "description": "Manufacturer Part Number",
                "example": "MPN-456"
              }
            },
            "description": "Structured product identifiers (UPC, SKU, MPN)",
            "example": {
              "upc": "012345678905",
              "sku": "SKU-123",
              "mpn": "MPN-456"
            }
          },
          "success": {
            "type": "boolean",
            "enum": [true],
            "description": "Indicates successful conversion",
            "example": true
          }
        },
        "required": ["asin", "identifiers", "success"]
      },
      "AsinFailureResult": {
        "type": "object",
        "properties": {
          "asin": {
            "type": "string",
            "minLength": 10,
            "maxLength": 10,
            "description": "The ASIN that failed conversion",
            "example": "B0EXAMPLE"
          },
          "error": {
            "type": "string",
            "minLength": 1,
            "description": "Error type/code",
            "example": "ProductNotFoundError"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable error message",
            "example": "Product not found for ASIN: B0EXAMPLE"
          },
          "success": {
            "type": "boolean",
            "enum": [false],
            "description": "Indicates failed conversion",
            "example": false
          }
        },
        "required": ["asin", "error", "message", "success"]
      },
      "AsinConversionResult": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/AsinSuccessResult"
          },
          {
            "$ref": "#/components/schemas/AsinFailureResult"
          }
        ]
      },
      "ConvertAsinResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AsinConversionResult"
            },
            "description": "Array of conversion results, one per input ASIN",
            "example": [
              {
                "asin": "B08N5WRWNW",
                "identifiers": {
                  "upc": "012345678905",
                  "sku": "SKU-123",
                  "mpn": "MPN-456"
                },
                "success": true
              },
              {
                "asin": "B0EXAMPLE",
                "error": "ProductNotFoundError",
                "message": "Product not found for ASIN: B0EXAMPLE",
                "success": false
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of ASINs processed",
            "example": 2
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully converted ASINs",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed conversions",
            "example": 1
          }
        },
        "required": ["results", "total", "successful", "failed"]
      },
      "ConvertAsinRequest": {
        "type": "object",
        "properties": {
          "asins": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 10,
              "maxLength": 10,
              "pattern": "^[A-Z0-9]{10}$",
              "description": "Amazon Standard Identification Number (10 alphanumeric characters)",
              "example": "B08N5WRWNW"
            },
            "minItems": 1,
            "maxItems": 10,
            "description": "Array of Amazon ASINs to convert to product identifiers (UPC, SKU, MPN)",
            "example": ["B08N5WRWNW", "B07ZPKN6YR"]
          }
        },
        "required": ["asins"]
      },
      "NormalizedProduct": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "imageUrl": {
            "type": "string"
          },
          "storeId": {
            "type": "string"
          },
          "price": {
            "type": "number"
          },
          "quantity": {
            "type": "number"
          },
          "lineTotal": {
            "type": "number"
          },
          "productIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["productIds"]
      },
      "NormalizationResult": {
        "anyOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/SuccessResult"
              },
              {
                "properties": {
                  "storeId": {
                    "type": "string",
                    "description": "Store ID from the cart event (coerced to string)",
                    "example": "8333"
                  },
                  "storeName": {
                    "type": "string",
                    "description": "Store name from the cart event",
                    "example": "Macy's"
                  },
                  "products": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/NormalizedProduct"
                    },
                    "description": "Array of normalized products with extracted IDs",
                    "example": [
                      {
                        "title": "Women's Cotton Sweater",
                        "url": "https://macys.com/shop/product?ID=12345",
                        "storeId": "8333",
                        "price": 4900,
                        "quantity": 1,
                        "productIds": ["12345"]
                      }
                    ]
                  },
                  "productCount": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Number of valid products after normalization",
                    "example": 1
                  },
                  "success": {
                    "type": "boolean",
                    "enum": [true],
                    "description": "Indicates successful processing",
                    "example": true
                  }
                },
                "required": ["products", "productCount", "success"]
              }
            ]
          },
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/FailureResult"
              },
              {
                "properties": {
                  "error": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Error type/code",
                    "example": "ValidationError"
                  },
                  "message": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Human-readable error message",
                    "example": "Invalid cart event structure"
                  },
                  "success": {
                    "type": "boolean",
                    "enum": [false],
                    "description": "Indicates failed processing",
                    "example": false
                  }
                },
                "required": ["error", "message", "success"]
              }
            ]
          }
        ]
      },
      "NormalizeCartViewsResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/NormalizationResult"
            },
            "description": "Array of normalization results, one per input cart view (order matches input)",
            "example": [
              {
                "storeId": "8333",
                "storeName": "Macy's",
                "products": [
                  {
                    "title": "Women's Cotton Sweater",
                    "url": "https://macys.com/shop/product?ID=12345",
                    "storeId": "8333",
                    "price": 4900,
                    "quantity": 1,
                    "productIds": ["12345"]
                  }
                ],
                "productCount": 1,
                "success": true
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of cart views processed",
            "example": 1
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully processed cart views",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed cart views",
            "example": 0
          },
          "totalProducts": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of normalized products across all views",
            "example": 1
          }
        },
        "required": ["results", "total", "successful", "failed", "totalProducts"]
      },
      "CartViewItem": {
        "type": "object",
        "properties": {
          "store_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              }
            ]
          },
          "store_name": {
            "type": "string"
          },
          "product_list": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                },
                "image_url": {
                  "type": "string"
                },
                "item_price": {
                  "type": "number"
                },
                "line_total": {
                  "type": "number"
                },
                "quantity": {
                  "type": "number"
                }
              }
            },
            "default": []
          },
          "cart_total": {
            "type": "number"
          },
          "cart_total_qty": {
            "type": "number"
          },
          "currency": {
            "type": "string"
          },
          "app_version": {
            "type": "string"
          },
          "application_type": {
            "type": "string"
          },
          "application_subtype": {
            "type": "string"
          },
          "browser": {
            "type": "string"
          },
          "browser_agent": {
            "type": "string"
          },
          "client": {
            "type": "string"
          },
          "platform": {
            "type": "string"
          },
          "page_url": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "session_id": {
            "type": "number"
          },
          "tenant": {
            "type": "string"
          },
          "timestamp": {
            "type": "number"
          },
          "toolbarid": {
            "type": "number"
          },
          "tracking_ticket": {
            "type": "string"
          },
          "free_shipping": {
            "type": ["boolean", "null"]
          },
          "member_guid": {
            "type": "string"
          },
          "user_id": {
            "type": "string"
          },
          "visit_id": {
            "type": "string"
          },
          "device_platform": {
            "type": "string"
          },
          "os_version": {
            "type": "string"
          },
          "created_ts": {
            "type": "string"
          },
          "created_ts_ms": {
            "type": "string"
          },
          "context_device": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "manufacturer": {
                "type": "string"
              },
              "model": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "adTrackingEnabled": {
                "type": "boolean"
              },
              "advertisingId": {
                "type": "string"
              }
            }
          },
          "context_location": {
            "type": "object",
            "properties": {
              "latitude": {
                "type": "number"
              },
              "longitude": {
                "type": "number"
              }
            }
          },
          "context_network": {
            "type": "object",
            "properties": {
              "carrier": {
                "type": "string"
              },
              "cellular": {
                "type": "boolean"
              },
              "wifi": {
                "type": "boolean"
              },
              "bluetooth": {
                "type": "boolean"
              }
            }
          },
          "context_os": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "version": {
                "type": "string"
              }
            }
          },
          "context_timezone": {
            "type": "string"
          },
          "device_ids": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "app_install_ts": {
            "type": "number"
          }
        }
      },
      "NormalizeCartViewsRequest": {
        "type": "object",
        "properties": {
          "events": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CartViewItem"
            },
            "minItems": 1,
            "maxItems": 100,
            "description": "Array of raw cart view events to normalize (1-100 per request)",
            "example": [
              {
                "store_id": 8333,
                "store_name": "Macy's",
                "product_list": [
                  {
                    "name": "Women's Cotton Sweater",
                    "url": "https://macys.com/shop/product?ID=12345",
                    "item_price": 4900,
                    "quantity": 1
                  }
                ]
              }
            ]
          }
        },
        "required": ["events"]
      },
      "NormalizeProductViewsResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/NormalizationResult"
                },
                {
                  "anyOf": [
                    {
                      "allOf": [
                        {
                          "$ref": "#/components/schemas/SuccessResult"
                        },
                        {
                          "properties": {
                            "storeId": {
                              "type": "string",
                              "description": "Store ID from the product view event (coerced to string)",
                              "example": "5246"
                            },
                            "storeName": {
                              "type": "string",
                              "description": "Store name from the product view event",
                              "example": "target.com"
                            },
                            "products": {
                              "type": "array",
                              "items": {
                                "allOf": [
                                  {
                                    "$ref": "#/components/schemas/NormalizedProduct"
                                  },
                                  {
                                    "properties": {
                                      "title": {
                                        "type": "string"
                                      },
                                      "url": {
                                        "type": "string"
                                      },
                                      "imageUrl": {
                                        "type": "string"
                                      },
                                      "storeId": {
                                        "type": "string"
                                      },
                                      "price": {
                                        "type": "number"
                                      },
                                      "productIds": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        }
                                      },
                                      "brand": {
                                        "type": "string"
                                      },
                                      "category": {
                                        "type": "string"
                                      },
                                      "description": {
                                        "type": "string"
                                      },
                                      "rating": {
                                        "type": "number"
                                      },
                                      "color": {
                                        "type": "string"
                                      },
                                      "skus": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        }
                                      },
                                      "gtins": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        }
                                      },
                                      "mpns": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  }
                                ]
                              },
                              "description": "Array of normalized products with extracted IDs",
                              "example": [
                                {
                                  "title": "Womens Short Sleeve Slim Fit Ribbed T-Shirt",
                                  "url": "https://www.target.com/p/women-s-short-sleeve-slim-fit-ribbed-t-shirt/-/A-88056717",
                                  "storeId": "5246",
                                  "price": 800,
                                  "productIds": ["88056717"],
                                  "brand": "A New Day"
                                }
                              ]
                            },
                            "productCount": {
                              "type": "integer",
                              "minimum": 0,
                              "description": "Number of normalized products",
                              "example": 1
                            },
                            "success": {
                              "type": "boolean",
                              "enum": [true],
                              "description": "Indicates successful processing",
                              "example": true
                            }
                          },
                          "required": ["products", "productCount", "success"]
                        }
                      ]
                    },
                    {
                      "allOf": [
                        {
                          "$ref": "#/components/schemas/FailureResult"
                        },
                        {
                          "properties": {
                            "error": {
                              "type": "string",
                              "minLength": 1,
                              "description": "Error type/code",
                              "example": "ValidationError"
                            },
                            "message": {
                              "type": "string",
                              "minLength": 1,
                              "description": "Human-readable error message",
                              "example": "Invalid product view event structure"
                            },
                            "success": {
                              "type": "boolean",
                              "enum": [false],
                              "description": "Indicates failed processing",
                              "example": false
                            }
                          },
                          "required": ["error", "message", "success"]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "description": "Array of normalization results, one per input product view (order matches input)",
            "example": [
              {
                "storeId": "5246",
                "storeName": "target.com",
                "products": [
                  {
                    "title": "Womens Short Sleeve Slim Fit Ribbed T-Shirt",
                    "url": "https://www.target.com/p/women-s-short-sleeve-slim-fit-ribbed-t-shirt/-/A-88056717",
                    "storeId": "5246",
                    "price": 800,
                    "productIds": ["88056717"],
                    "brand": "A New Day"
                  }
                ],
                "productCount": 1,
                "success": true
              }
            ]
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of product views processed",
            "example": 1
          },
          "successful": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successfully processed product views",
            "example": 1
          },
          "failed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of failed product views",
            "example": 0
          },
          "totalProducts": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of normalized products across all views",
            "example": 1
          }
        },
        "required": ["results", "total", "successful", "failed", "totalProducts"]
      },
      "ProductViewItem": {
        "type": "object",
        "properties": {
          "store_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              }
            ]
          },
          "store_name": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "product_url": {
            "type": "string"
          },
          "image_url": {
            "type": "string"
          },
          "image_url_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "sku": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "sku_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "gtin": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "gtin_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "productID": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "productid_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "mpn": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "mpn_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "offers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "price": {
                  "type": "number"
                },
                "sku": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                }
              }
            }
          },
          "offer_list": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "offer_amount": {
                  "type": "number"
                },
                "offer_currency": {
                  "type": "string"
                },
                "offer_sku": {
                  "type": "string"
                }
              }
            }
          },
          "urlToSku": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "priceToSku": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "brand": {
            "type": "string"
          },
          "brand_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rating": {
            "type": "number"
          },
          "description": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "breadcrumbs": {
            "type": "string"
          },
          "color": {
            "type": "string"
          },
          "color_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "app_version": {
            "type": "string"
          },
          "application_type": {
            "type": "string"
          },
          "application_subtype": {
            "type": "string"
          },
          "browser": {
            "type": "string"
          },
          "browser_agent": {
            "type": "string"
          },
          "client": {
            "type": "string"
          },
          "platform": {
            "type": "string"
          },
          "page_url": {
            "type": "string"
          },
          "session_id": {
            "type": "number"
          },
          "tenant": {
            "type": "string"
          },
          "timestamp": {
            "type": "number"
          },
          "toolbarid": {
            "type": "number"
          },
          "tracking_ticket": {
            "type": "string"
          },
          "member_guid": {
            "type": "string"
          },
          "user_id": {
            "type": "string"
          },
          "visit_id": {
            "type": "string"
          },
          "device_platform": {
            "type": "string"
          },
          "os_version": {
            "type": "string"
          },
          "created_ts": {
            "type": "string"
          },
          "created_ts_ms": {
            "type": "string"
          },
          "context_device": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "manufacturer": {
                "type": "string"
              },
              "model": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "adTrackingEnabled": {
                "type": "boolean"
              },
              "advertisingId": {
                "type": "string"
              }
            }
          },
          "context_location": {
            "type": "object",
            "properties": {
              "latitude": {
                "type": "number"
              },
              "longitude": {
                "type": "number"
              }
            }
          },
          "context_network": {
            "type": "object",
            "properties": {
              "carrier": {
                "type": "string"
              },
              "cellular": {
                "type": "boolean"
              },
              "wifi": {
                "type": "boolean"
              },
              "bluetooth": {
                "type": "boolean"
              }
            }
          },
          "context_os": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "version": {
                "type": "string"
              }
            }
          },
          "context_timezone": {
            "type": "string"
          },
          "device_ids": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "app_install_ts": {
            "type": "number"
          }
        }
      },
      "NormalizeProductViewsRequest": {
        "type": "object",
        "properties": {
          "events": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductViewItem"
            },
            "minItems": 1,
            "maxItems": 100,
            "description": "Array of raw product view events to normalize (1-100 per request)",
            "example": [
              {
                "store_id": 5246,
                "store_name": "target.com",
                "name": "Womens Short Sleeve Slim Fit Ribbed T-Shirt",
                "url": "https://www.target.com/p/women-s-short-sleeve-slim-fit-ribbed-t-shirt/-/A-88056717",
                "sku": ["88056717"],
                "offers": [
                  {
                    "price": 800,
                    "sku": "88056717"
                  }
                ],
                "brand": "A New Day"
              }
            ]
          }
        },
        "required": ["events"]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Health check endpoint for monitoring and load balancer probes",
        "tags": ["Monitoring"],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/product-identifiers/urls": {
      "post": {
        "summary": "Extract Product Identifiers from URLs",
        "description": "Extracts product identifiers from one or more product URLs using pattern-based rule sets. Accepts 1-100 URLs per request. Handles partial failures gracefully - each URL is processed independently and results include success/failure status. Returns summary statistics along with individual results. Supports URLs from various e-commerce stores.",
        "tags": ["Product Identifier Extraction"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUrlAnalysisRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully extracted product IDs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateUrlAnalysisResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ValidationError",
                  "message": "urls: At least one URL is required",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "InternalServerError",
                  "message": "An unexpected error occurred",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    },
    "/product-identifiers/asins": {
      "post": {
        "summary": "Convert ASINs to Product Identifiers",
        "description": "Converts Amazon Standard Identification Numbers (ASINs) to product identifiers including GTINs (UPC/EAN), MPN, and SKU. Uses the Synccentric product database API. Accepts 1-10 ASINs per request and returns all available product identifiers. Handles partial failures gracefully - each ASIN is processed independently and results include success/failure status.",
        "tags": ["Product Identifier Extraction"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConvertAsinRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully converted ASINs to product identifiers",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConvertAsinResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ValidationError",
                  "message": "asins: Array must contain at least 1 element(s)",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error or API error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "ApiRequestError",
                  "message": "Synccentric API request failed: 500 Internal Server Error",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    },
    "/cart-views/normalize": {
      "post": {
        "summary": "Normalize Cart View Events",
        "description": "Normalizes raw cart view events from Rakuten apps and extensions using @rr/cart-event-normalizer. Extracts product identifiers from URLs and standardizes the data format. Accepts 1-100 cart views per request. Handles partial failures gracefully - each view is processed independently and results include success/failure status. Returns normalized products with extracted IDs and summary statistics.",
        "tags": ["Event Normalization"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NormalizeCartViewsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully normalized cart view events",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NormalizeCartViewsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "properties": {
                        "error": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Error type/code",
                          "example": "ValidationError"
                        },
                        "message": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Human-readable error message",
                          "example": "events: At least one cart event is required"
                        },
                        "statusCode": {
                          "type": "integer",
                          "minimum": 400,
                          "maximum": 599,
                          "description": "HTTP status code",
                          "example": 400
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "error": "ValidationError",
                  "message": "events: At least one cart view is required",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "properties": {
                        "error": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Error type/code",
                          "example": "ValidationError"
                        },
                        "message": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Human-readable error message",
                          "example": "events: At least one cart event is required"
                        },
                        "statusCode": {
                          "type": "integer",
                          "minimum": 400,
                          "maximum": 599,
                          "description": "HTTP status code",
                          "example": 400
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "error": "InternalServerError",
                  "message": "An unexpected error occurred",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    },
    "/product-views/normalize": {
      "post": {
        "summary": "Normalize Product View Events",
        "description": "Normalizes raw product view events (PDP visits) from Rakuten apps and extensions using @rr/product-event-normalizer. Consolidates product identifiers from multiple schema.org sources (SKU, GTIN, MPN, offers) and extracts IDs from URLs as fallback. Accepts 1-100 product views per request. Handles partial failures gracefully - each view is processed independently and results include success/failure status. Returns normalized products with comprehensive identifier coverage and summary statistics.",
        "tags": ["Event Normalization"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NormalizeProductViewsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully normalized product view events",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NormalizeProductViewsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "properties": {
                        "error": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Error type/code",
                          "example": "ValidationError"
                        },
                        "message": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Human-readable error message",
                          "example": "events: At least one product view event is required"
                        },
                        "statusCode": {
                          "type": "integer",
                          "minimum": 400,
                          "maximum": 599,
                          "description": "HTTP status code",
                          "example": 400
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "error": "ValidationError",
                  "message": "events: At least one product view is required",
                  "statusCode": 400
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "properties": {
                        "error": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Error type/code",
                          "example": "ValidationError"
                        },
                        "message": {
                          "type": "string",
                          "minLength": 1,
                          "description": "Human-readable error message",
                          "example": "events: At least one product view event is required"
                        },
                        "statusCode": {
                          "type": "integer",
                          "minimum": 400,
                          "maximum": 599,
                          "description": "HTTP status code",
                          "example": 400
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "error": "InternalServerError",
                  "message": "An unexpected error occurred",
                  "statusCode": 500
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}
